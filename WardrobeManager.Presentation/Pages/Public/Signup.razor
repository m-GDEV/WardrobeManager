@using WardrobeManager.Presentation.Components.Identity

@page "/signup"

<PageTitle>Sign Up</PageTitle>


<LoginOrSignup PageHeaderText="Sign Up" SubmitButtonText="Sign Up" SubmitButtonCallback="RegisterMethod" RedirectHeaderText="Already have an account?" RedirectLinkText="Log In" RedirectLinkPath="/login" />

@code {
    public async Task RegisterMethod(LoginOrSignupModel data)
    {
        var res = await _accountManagement.RegisterAsync(data.email, data.password);

        if (!res.Succeeded)
        {
            foreach (var error in res.ErrorList)
            {
                _notificationService.AddNotification(error, NotificationType.Error);
            }

            return;
        }
        
        // For some reason blazor shows the NotAuthorized thing if i redirect too fast
        await Task.Delay(1000);
        _navManager.NavigateTo("/dashboard");
    }
}